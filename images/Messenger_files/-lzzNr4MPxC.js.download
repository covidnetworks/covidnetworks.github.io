if (self.CavalryLogger) { CavalryLogger.start_js(["ejg4M"]); }

__d("PhotoViewerDimensions",["Event","PhotoUtils","Vector"],(function(a,b,c,d,e,f){var g={verticalPadding:"number",horizontalPadding:"number",normalResDim:"object"};a=function(){"use strict";function a(a){this._verticalPadding=40;this._horizontalPadding=60;this._normalResDim={x:960,y:960};this._photoStripHeight=88;for(var c in a){if(!g[c])throw new Error("Unsupported extraData value '"+c+"' should not be used");typeof a[c]===g[c]&&(this["_"+c]=a[c])}this._listener=b("Event").listen(window,"resize",this._resetMaxStageDimensions.bind(this))}var c=a.prototype;c.destroy=function(){this._listener.remove()};c.getStageDimensions=function(a){var c=this.getMaxStageDimensions();c=new(b("Vector"))(Math.min(a.x,c.x),Math.min(a.y,c.y));var d=c.x/c.y;a=a.x/a.y;d<a?c.y=Math.round(c.x/a):c.x=Math.round(c.y*a);return c};c.getImageDimensionsForStage=function(a,c){var d=a.x;a=a.y;var e=c.x;c=c.y;if(d>=e||a>=c){var f=d/a,g=e/c;g<f?(d=e,a=Math.round(e/f)):g>f?(d=Math.round(c*f),a=c):(d=e,a=c)}return new(b("Vector"))(d,a)};c.getImageDimensionsForMaxStage=function(a,c){var d=a.x;a=a.y;var e=c.x;c=c.y-this._photoStripHeight;var f=d/a,g=e/c;d>=e||a>=c?g<f?(d=e,a=Math.round(e/f)):g>f?(d=Math.round(c*f),a=c):(d=e,a=c):f<g?d=Math.round(a*f):a=Math.round(d/f);return new(b("Vector"))(d,a)};c.getMaxStageDimensions=function(){this._maxStageDimensions||(this._maxStageDimensions=new(b("Vector"))(b("Vector").getViewportDimensions().x-this._horizontalPadding,b("Vector").getViewportDimensions().y-this._verticalPadding));return this._maxStageDimensions};c.getMaxStageDimensionsWithoutPadding=function(){this._maxStageDimensions||(this._maxStageDimensions=new(b("Vector"))(b("Vector").getViewportDimensions().x,b("Vector").getViewportDimensions().y));return this._maxStageDimensions};c._resetMaxStageDimensions=function(){this._maxStageDimensions=null};c.getBestFitImageFromPhoto=function(a,c){var d=null;a=b("PhotoUtils").getImagesFromData(a);a=a.sort(function(a,b){return b.width-a.width});window.devicePixelRatio&&window.devicePixelRatio>1&&(c=new(b("Vector"))(c.x*window.devicePixelRatio,c.y*window.devicePixelRatio));for(var e=0;e<a.length;e++)(!d||a[e].width>=c.x||a[e].height>=c.y)&&(d=a[e]);return d};c.getOriginalDimensionsFromPhoto=function(a){a=b("PhotoUtils").getOriginalImageFromData(a);return new(b("Vector"))(a.width,a.height)};c.getBestFitDimensionsFromPhoto=function(a,c){a=this.getBestFitImageFromPhoto(a,c);return new(b("Vector"))(a.width,a.height)};c.getVerticalPadding=function(){return this._verticalPadding};c.getHorizontalPadding=function(){return this._horizontalPadding};return a}();e.exports=a}),null);
__d("SpotlightViewerBottomBar",["cx","LeftRight.react","React","joinClasses"],(function(a,b,c,d,e,f,g){var h=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){var a=Array.isArray(this.props.children)?this.props.children:[this.props.children],c="_4_8n _51an";this.props.className&&(c=b("joinClasses")(c,this.props.className));if(a.length===1)return h.jsx("div",{className:c,children:a[0]});c=b("joinClasses")(c,"_50-m");return h.jsxs(b("LeftRight.react"),{className:c,children:[a[0],a[1]]})};return c}(h.Component);e.exports=a}),null);
__d("SpotlightViewerBottomBarGroup",["cx","React"],(function(a,b,c,d,e,f,g){var h=b("React");a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var c=b.prototype;c.render=function(){var a=this.props.itemmargin||"right";a=(a=="left"?"marginLeft":"")+(a=="right"?" marginRight":"")+" _4_8i";return h.jsx("div",{className:a,children:this.props.children})};return b}(h.Component);e.exports=a}),null);
__d("SpotlightViewerClose",["cx","fbt","React","TooltipLink.react","emptyFunction","joinClasses","prop-types"],(function(a,b,c,d,e,f,g,h){var i=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){var a=this.props.position=="left"?"_5wx3":"_5wx4",c=i.jsx("span",{children:h._("Press Esc to close")});return i.jsx(b("TooltipLink.react"),{className:b("joinClasses")("_4-o9 _50-m _51an",a,this.props.isFixed?"_2chv":""),onClick:this.props.onClick,onKeyPress:this.props.onKeyPress,tooltip:c,tabIndex:"0"})};return c}(i.Component);e.exports=a;a.propTypes={position:b("prop-types").oneOf(["left","right"]),isFixed:b("prop-types").bool,onKeyPress:b("prop-types").func};a.defaultProps={position:"right",isFixed:!1,onKeyPress:b("emptyFunction")}}),null);
__d("MessagingVideoViewer.react",["cx","fbt","ActorURI","ArbiterMixin","AsyncRequest","MessagingForwardingButtonNUX.react","PageTransitionsRegistrar","PhotoViewerDimensions","React","ReactFragment","SpotlightViewer","SpotlightViewerBottomBar","SpotlightViewerBottomBarGroup","SpotlightViewerBottomBarLink","SpotlightViewerClose","SpotlightViewport","Vector","XMessagingVideoAttachmentController","createReactClass_DEPRECATED","guid","prop-types"],(function(a,b,c,d,e,f,g,h){var i=b("React"),j=200;c=b("createReactClass_DEPRECATED")({displayName:"MessagingVideoViewer",propTypes:{disableForward:(a=b("prop-types")).bool,forwardDialogComponent:a.func.isRequired,pageID:a.number,rootClassName:a.string,videoSize:a.instanceOf(b("Vector")).isRequired,videoID:a.string.isRequired,videoURI:a.string.isRequired},mixins:[b("ArbiterMixin")],getInitialState:function(){var a=new(b("PhotoViewerDimensions"))({verticalPadding:j});return{dimensions:a.getStageDimensions(this.props.videoSize),loading:!0,open:!0,showForward:!1}},UNSAFE_componentWillMount:function(){this._domID=b("guid")()},componentDidMount:function(){var a=this;this._loadVideoPlayer();b("PageTransitionsRegistrar").registerCompletionCallback(function(){a.close();return!0})},_loadVideoPlayer:function(){var a=this,c=b("XMessagingVideoAttachmentController").getURIBuilder().setString("video_id",this.props.videoID).setString("video_container_id",this._domID).setInt("width",this.state.dimensions.x).setInt("height",this.state.dimensions.y).getURI();this.props.pageID&&(c=b("ActorURI").create(c,this.props.pageID));this.request=new(b("AsyncRequest"))().setMethod("GET").setURI(c).setReadOnly(!0).setHandler(function(b){return a.setState({loading:!1})}).send()},close:function(){if(!this.state.open)return;this.setState({open:!1},function(){this.inform("close")})},_showForwardDialog:function(){this.setState({showForward:!0}),this.refs_forwardNUX.close()},_hideForwardDialog:function(){this.setState({showForward:!1})},renderLayers:function(){var a=this;if(this.props.disableForward)return null;var c=h._("Forward"),d=this.props.forwardDialogComponent;return b("ReactFragment").create({forwardDialog:i.jsx(d,{attachmentID:this.props.videoID,onClose:this._hideForwardDialog,shown:this.state.showForward,title:c}),forwardButtonNUX:i.jsx(b("MessagingForwardingButtonNUX.react"),{contextRef:function(){return a.refs_forwardButton},ref:function(b){return a.refs_forwardNUX=b},children:h._("Send this video to other people in separate messages.")})})},render:function(){var a=this,c=i.jsx("div",{className:"rfloat",id:this._domID}),d;this.props.disableForward||(d=i.jsx(b("SpotlightViewerBottomBarLink"),{onClick:this._showForwardDialog,ref:function(b){return a.refs_forwardButton=b},children:h._("Forward")}));return i.jsxs("span",{children:[i.jsx(b("SpotlightViewer"),{onHide:this.close,open:this.state.open,rootClassName:this.props.rootClassName,children:i.jsxs(b("SpotlightViewport"),{active:!0,className:"_39hc",media:c,showLoadingIndicator:this.state.loading,stageDimensions:this.state.dimensions,useWidth:!0,children:[i.jsx(b("SpotlightViewerClose"),{onClick:this.close}),i.jsxs(b("SpotlightViewerBottomBar"),{className:"stat_elem",children:[i.jsx(b("SpotlightViewerBottomBarGroup"),{}),i.jsxs(b("SpotlightViewerBottomBarGroup"),{children:[d,i.jsx(b("SpotlightViewerBottomBarLink"),{s:"true",href:this.props.videoURI,children:h._("Download")})]})]})]})}),this.renderLayers()]})}});e.exports=c}),null);
__d("SpotlightViewerAutoResize",["invariant","Event","SubscriptionsHandler"],(function(a,b,c,d,e,f,g){a=function(){"use strict";function a(a){this.$1=a,typeof this.$1.onResize==="function"||g(0,1068)}var c=a.prototype;c.enable=function(){this.$2=new(b("SubscriptionsHandler"))(),this.$2.addSubscriptions(b("Event").listen(window,"resize",this.$1.onResize))};c.disable=function(){this.$2.release(),delete this.$2};return a}();e.exports=a}),null);
__d("SpotlightViewerBehaviorsMixin",["BehaviorsMixin"],(function(a,b,c,d,e,f){a={UNSAFE_componentWillMount:function(){this.behaviors&&this.enableBehaviors(this.behaviors)},componentWillUnmount:function(){this.destroyBehaviors()}};Object.assign(a,b("BehaviorsMixin"));c=a;e.exports=c}),null);
__d("PhotoLogger",["BanzaiScuba","Event","ProfilePhotosViewFalcoEvent","SubscriptionsHandler"],(function(a,b,c,d,e,f){a=function(){function a(a){this.$1=a,this.$2={}}var c=a.prototype;c.log=function(a,c,d,e){b("ProfilePhotosViewFalcoEvent").log(function(){return{photo_fbid:c,source:d,profile_id:e}}),this.$2[a]||(this.$3(a),this.$2[a]=!0)};c.$3=function(a){this.$4("loading",{uri:a});var c=new(b("SubscriptionsHandler"))(),d=new Image();c.addSubscriptions(b("Event").listen(d,"load",function(){this.$4("loaded",{uri:a}),c.release()}.bind(this)),b("Event").listen(d,"error",function(){this.$4("error",{uri:a}),c.release()}.bind(this)),b("Event").listen(d,"abort",function(){this.$4("abort",{uri:a}),c.release()}.bind(this)));d.src=a};c.logEvent=function(a){this.$4(a)};c.$4=function(a,c){var d=new(b("BanzaiScuba"))("photos_client_loading",null,{addBrowserFields:!0});d.addNormal("event",a);d.addNormal("viewer",this.$1);for(var e in c)d.addNormal(e,c[e]);d.post()};return a}();e.exports=a}),null);
__d("PhotoViewState",["ArbiterMixin","PhotoStore","PhotoUtils","mixin"],(function(a,b,c,d,e,f){a=function(a){babelHelpers.inheritsLoose(c,a);function c(b,c,d){var e;e=a.call(this)||this;d=d||{};e._viewer=b;e._setID=c;e._position=d.position||0;e._preventPreload=d.preventPreload;e._reverse=d.reverse;e._updateCallback=d.updateCallback;e._preloaded={};return e}var d=c.prototype;d._fetchCallback=function(a){if(!this._viewer.isOpen())return;this._preload(a);this._log("data_fetch_complete")};d._preload=function(a){b("PhotoUtils").preload(this._viewer,a,function(a){this._preloaded[b("PhotoUtils").getFBIDFromData(a)]=!0}.bind(this))};d._preloadPhotosInRange=function(a,c){var d=[];for(var a=a;a<=c;++a){var e=b("PhotoStore").getByIndexImmediate(this._setID,a);e&&!this._isPreloaded(e)&&d.push(e)}this._preload(d)};d._isPreloaded=function(a){return this._preloaded[b("PhotoUtils").getFBIDFromData(a)]};d.getPosition=function(){return this._position};d.isValidMovement=function(a){if(!b("PhotoStore").hasBeenCreated(this._setID))return!1;if(b("PhotoStore").hasLooped(this._setID))return!0;a=this._position+a;var c=b("PhotoStore").getAvailableRange(this._setID),d=c.offset+c.length-1;return a>=c.offset-1&&a<=d+1};d.getRelativeMovement=function(a){return b("PhotoStore").getIndexForID(this._setID,a)-this._position};d.moveCursor=function(a){if(!this.isValidMovement(a))return!1;this._position+=a;return!0};d._page=function(a){if(!this.moveCursor(a))return;this._log("page_begin");var d=b("PhotoStore").getByIndexImmediate(this._setID,this._position);!d?(this.inform("photo_fetch"),this._log("photo_fetch")):this._isPreloaded(d)||this._preload([d]);b("PhotoStore").getByIndex(this._setID,this._position,this._updateCallback);this._loadMoreIfNecessary(a>0,c.BUFFER_SIZE);this._log("page_complete")};d.loadMoreForwardIfNecessary=function(a){if(this._preventPreload)return;var c=b("PhotoStore").getAvailableRange(this._setID);c=c.offset+c.length-1;var d=this._position+a;if(d>c&&!b("PhotoStore").hasLooped(this._setID)){c=b("PhotoStore").getCursorByIndexImmediate(this._setID,c);b("PhotoStore").fetchForward(this._setID,c,a,this._fetchCallback.bind(this))}else this._preloadPhotosInRange(this._position+1,d)};d.loadMoreBackwardIfNecessary=function(a){if(this._preventPreload)return;var c=b("PhotoStore").getAvailableRange(this._setID),d=this._position-a;if(d<c.offset&&!b("PhotoStore").hasLooped(this._setID)){c=b("PhotoStore").getCursorByIndexImmediate(this._setID,c.offset);b("PhotoStore").fetchBackward(this._setID,c,a,this._fetchCallback.bind(this))}else this._preloadPhotosInRange(d,this._position-1)};d._loadMoreIfNecessary=function(a,b){a?this.loadMoreForwardIfNecessary(b):this.loadMoreBackwardIfNecessary(b)};d.displayFirst=function(){if(!this._viewer.isOpen())return;b("PhotoStore").setPreFetchCallback(this._setID,function(){this._log("data_fetch_begin")}.bind(this));var a=function(a){this._isPreloaded(a)||this._preload([a]),this._updateCallback&&this._updateCallback(a)}.bind(this);b("PhotoStore").getByIndex(this._setID,this._position,a);this._reverse?this.loadMoreBackwardIfNecessary(c.BUFFER_SIZE):this.loadMoreForwardIfNecessary(c.BUFFER_SIZE)};d.backward=function(){this._page(this._reverse?1:-1)};d.forward=function(){this._page(this._reverse?-1:1)};d._log=function(a){this._viewer.log(a)};return c}(b("mixin")(b("ArbiterMixin")));e.exports=a;Object.assign(a,{BUFFER_SIZE:4})}),null);
__d("SpotlightViewerCoreMixin",["PhotoLogger","PhotoStore","PhotoUtils","PhotoViewState","React","SpotlightViewerImage"],(function(a,b,c,d,e,f){var g=b("React");a={_displayFirstPhoto:function(){b("PhotoStore").executePostCreate(this.props.setid,this.viewState.displayFirst.bind(this.viewState))},_getInitialPosition:function(){var a;this.props.clearcache||(a=b("PhotoStore").getIndexForID(this.props.setid,this.props.photoid));a===void 0&&(b("PhotoStore").clearSetCache(this.props.setid),a=0);return a},__displayPhoto:function(){var a=this._getInitialPosition();this.viewState=new(b("PhotoViewState"))(this,this.props.setid,{position:a,preventPreload:this.__shouldPreventPhotoPreload,reverse:this.props.reverse,updateCallback:this._updatePhoto});this.inform("open");this._displayFirstPhoto()},UNSAFE_componentWillMount:function(){this._logger=new(b("PhotoLogger"))(this.getViewerID()),this.log("open_begin"),this.__displayPhoto()},componentDidMount:function(){this._enableSubscriptions&&this._enableSubscriptions(),this.log("open_complete")},isOpen:function(){return this.state.open},close:function(){if(!this.isOpen())return;this.log("close_begin");this.setState({open:!1},function(){this.inform("close"),this.log("close_complete")})},componentWillUnmount:function(){this.viewState=null},_onClickViewport:function(a){a?this.viewState.forward():this.viewState.backward()},_getMedia:function(a,c){return g.jsx(b("SpotlightViewerImage"),{ref:"image",src:a.uri,dimensions:c.imageDimensions})},_getCurrentFBID:function(){return b("PhotoUtils").getFBIDFromData(this.state.photoData)},_updatePhoto:function(a){this.log("photo_change_begin"),this.setState({photoData:a},function(){this.inform("photo_change",this.state.photoData),this.log("photo_change_complete")})},getLogger:function(){return this._logger},log:function(a){this._logger&&this._logger.logEvent(a)}};e.exports=a}),null);
__d("SpotlightViewerStageResizer",["Event","MessengerEnvironment","SubscriptionsHandler","Vector"],(function(a,b,c,d,e,f){var g=520;a=function(){"use strict";function a(a,c){this._subscriptionsHandler=new(b("SubscriptionsHandler"))(),this._subscriptionsHandler.addSubscriptions(b("Event").listen(window,"resize",this._resetStageDimensions.bind(this))),this._dimensions=a,this._minHeight=c.minHeight||g,this._minWidth=c.minWidth||g,this._resetStageDimensions()}var c=a.prototype;c.destroy=function(){this._dimensions=null,this._subscriptionsHandler.release()};c._resetStageDimensions=function(){this._currentStageDimensions=new(b("Vector"))(this._minWidth,this._minHeight)};c.getImageAndStageDimensions=function(a){a=this._dimensions.getBestFitDimensionsFromPhoto(a,this._dimensions.getMaxStageDimensions());var c=b("MessengerEnvironment").messengerui?this._dimensions.getMaxStageDimensionsWithoutPadding(a):this._dimensions.getStageDimensions(a);this._currentStageDimensions=new(b("Vector"))(Math.max(c.x,this._minWidth,this._currentStageDimensions.x),Math.max(c.y,this._minHeight,this._currentStageDimensions.y));c=b("MessengerEnvironment").messengerui?this._dimensions.getImageDimensionsForMaxStage(a,this._currentStageDimensions):this._dimensions.getImageDimensionsForStage(a,this._currentStageDimensions);return{stageDimensions:this._currentStageDimensions,imageDimensions:c}};c.getCurrentStageDimensions=function(){return this._currentStageDimensions};return a}();e.exports=a}),null);
__d("SpotlightViewerDimensionMixin",["MessengerEnvironment","PhotoViewerDimensions","SpotlightViewerStageResizer"],(function(a,b,c,d,e,f){f.getInitialState=a;f.componentWillUnmount=c;f.getMedia=d;f.getDimensions=e;f.getStageDimensions=g;f.getImageDimensions=h;f.onResize=i;function a(){this._dimensions=new(b("PhotoViewerDimensions"))({verticalPadding:this.props.verticalPadding,horizontalPadding:this.props.horizontalPadding});this._resizer=new(b("SpotlightViewerStageResizer"))(this._dimensions,{minHeight:this.props.minHeight,minWidth:this.props.minWidth});return{maxStageDimensions:b("MessengerEnvironment").messengerui?this._dimensions.getMaxStageDimensionsWithoutPadding():this._dimensions.getMaxStageDimensions()}}function c(){this._resizer&&this._resizer.destroy(),this._resizer=null,this._dimensions&&this._dimensions.destroy(),this._dimensions=null}function d(){if(this.state.photoData){if(this.state.photoData.__typename&&this.state.photoData.__typename==="MessageVideo")return this._getVideo();var a=this._resizer.getImageAndStageDimensions(this.state.photoData),b=this._dimensions.getBestFitImageFromPhoto(this.state.photoData,this.state.maxStageDimensions);return this._getMedia(b,a)}else return null}function e(){return this._dimensions}function g(){if(this.state.photoData)return this._resizer.getImageAndStageDimensions(this.state.photoData).stageDimensions;else return b("MessengerEnvironment").messengerui?this._dimensions.getMaxStageDimensionsWithoutPadding():this._dimensions.getMaxStageDimensions()}function h(){return!this.state.photoData?null:this._resizer.getImageAndStageDimensions(this.state.photoData).imageDimensions}function i(){if(b("MessengerEnvironment").messengerui){var a=this._dimensions.getMaxStageDimensionsWithoutPadding();this.setState({maxStageDimensions:a,width:a.x})}else this.setState({maxStageDimensions:this._dimensions.getMaxStageDimensions()})}}),null);
__d("SpotlightViewerPageWithKeys",["KeyEventController","SubscriptionsHandler"],(function(a,b,c,d,e,f){a=function(){"use strict";function a(a){this.$1=a}var c=a.prototype;c.enable=function(){this.$2=new(b("SubscriptionsHandler"))(),this.$2.addSubscriptions(b("KeyEventController").registerKey("LEFT",function(){this.$1.viewState.backward();return!1}.bind(this)),b("KeyEventController").registerKey("RIGHT",function(){this.$1.viewState.forward();return!1}.bind(this)))};c.disable=function(){this.$2.release(),delete this.$2};return a}();e.exports=a}),null);
__d("SpotlightViewerPagers",["cx","LeftRight.react","Link.react","React"],(function(a,b,c,d,e,f,g){var h=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){return h.jsxs(b("LeftRight.react"),{children:[h.jsx(b("Link.react"),{className:"_4-oa _4-ob _50-m"}),h.jsx(b("Link.react"),{className:"_4-oa _4-oc _50-m"})]})};return c}(h.Component);e.exports=a}),null);
__d("SpotlightViewerThumbnailMixin",["PhotoStore","Vector"],(function(a,b,c,d,e,f){f._getInitialPhotoData=a;f._getThumbnailPhotoData=c;function a(){var a=b("PhotoStore").getIndexForID(this.props.setid,this.props.photoid);a=b("PhotoStore").getByIndexImmediate(this.props.setid,a);return a?a:this._getThumbnailPhotoData()}function c(){if(!this.props.dimensions||!this.props.thumbsrc)return null;var a={id:this.props.photoid};for(var c=0;c<this.props.dimensions.length;++c){var d=b("Vector").deserialize(this.props.dimensions[c]);a["image"+c]={width:d.x,height:d.y,uri:this.props.thumbsrc}}return a}}),null);
__d("SpotlightMessagesViewer",["fbt","ActorURI","ArbiterMixin","MessagingForwardingButtonNUX.react","PageTransitionsRegistrar","React","ReactFragment","SpotlightViewer","SpotlightViewerAutoResize","SpotlightViewerBehaviorsMixin","SpotlightViewerBottomBar","SpotlightViewerBottomBarGroup","SpotlightViewerBottomBarLink","SpotlightViewerClose","SpotlightViewerCoreMixin","SpotlightViewerDimensionMixin","SpotlightViewerPagers","SpotlightViewerPageWithKeys","SpotlightViewerThumbnailMixin","SpotlightViewport","SubscriptionsHandler","XMessagingPhotoDownloadController","createReactClass_DEPRECATED"],(function(a,b,c,d,e,f,g){var h=b("React");a=b("createReactClass_DEPRECATED")({displayName:"SpotlightMessagesViewer",mixins:[b("ArbiterMixin"),b("SpotlightViewerBehaviorsMixin"),b("SpotlightViewerCoreMixin"),b("SpotlightViewerThumbnailMixin"),b("SpotlightViewerDimensionMixin")],behaviors:[b("SpotlightViewerPageWithKeys"),b("SpotlightViewerAutoResize")],componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release(),this._subscriptions=null},getViewerID:function(){return this.props.setid},getInitialState:function(){this._subscriptions=new(b("SubscriptionsHandler"))();return{photoData:this._getInitialPhotoData(),open:!0,showForward:!1}},_enableSubscriptions:function(){var a=this;this.props.useloadingindicator&&this._subscriptions.addSubscriptions(this.viewState.subscribe("photo_fetch",function(){return a.setState({photoData:null})}))},_showForwardDialog:function(){this.setState({showForward:!0}),this.refs_forwardNUX.close()},_hideForwardDialog:function(){this.setState({showForward:!1})},renderLayers:function(){var a=this;if(this.props.disableForward)return null;var c=g._("Forward"),d=this.props.forwardDialogComponent;return b("ReactFragment").create({forwardDialog:h.jsx(d,{attachmentID:String(this.state.photoData.id),onClose:this._hideForwardDialog,shown:this.state.showForward,title:c}),forwardButtonNUX:h.jsx(b("MessagingForwardingButtonNUX.react"),{contextRef:function(){return a.refs_forwardButton},ref:function(b){return a.refs_forwardNUX=b},children:g._("Send this image to other people in separate messages.")})})},render:function(){var a=this,c=this.getMedia(),d=this.props.snapToPhoto?this.getImageDimensions():this.getStageDimensions();d.x=Math.max(d.x,185);d.y=Math.max(d.y,185);var e=this.props.useloadingindicator&&!this.state.photoData;b("PageTransitionsRegistrar").registerCompletionCallback(function(){a.state.open&&a.close();return!0});return h.jsxs("span",{children:[h.jsx(b("SpotlightViewer"),{rootClassName:this.props.rootClassName,open:this.state.open,onHide:this.close,children:h.jsxs(b("SpotlightViewport"),{active:!1,onClick:this._onClickViewport,stageDimensions:d,media:c,showLoadingIndicator:e,useWidth:!0,children:[h.jsx(b("SpotlightViewerClose"),{onClick:this.close}),this.props.disablepaging?null:h.jsx(b("SpotlightViewerPagers"),{}),this._renderBottomBar()]})}),this.renderLayers()]})},_renderBottomBar:function(){var a=this,c;this.props.disableForward||(c=h.jsx(b("SpotlightViewerBottomBarLink"),{onClick:this._showForwardDialog,ref:function(b){return a.refs_forwardButton=b},children:g._("Forward")}));var d=b("XMessagingPhotoDownloadController").getURIBuilder().setString("photo_id",String(this.state.photoData.id)).getURI();this.props.actorid&&(d=b("ActorURI").create(d,this.props.actorid));return h.jsxs(b("SpotlightViewerBottomBar"),{children:[h.jsx(b("SpotlightViewerBottomBarGroup"),{}),h.jsxs(b("SpotlightViewerBottomBarGroup"),{children:[c,h.jsx(b("SpotlightViewerBottomBarLink"),{rel:"async",ajaxify:d,children:g._("Download")})]})]})}});e.exports=a}),null);